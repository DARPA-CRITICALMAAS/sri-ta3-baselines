<div align="center">

# DARPA AIE CriticalMAAS - SRI TA3 Baselines
<a href="https://pytorch.org/get-started/locally/"><img alt="PyTorch" src="https://img.shields.io/badge/Python 3.8-3670A0?logo=python&logoColor=ffdd54"></a>
</div>

## Install
1. Create the conda environment - `conda create -n ta3-baseline python=3.8`
2. Activate conda environment - `conda activate ta3-baseline`
3. Install gdal and raterio using conda - `conda install -c conda-forge "gdal>=3.0.2, <4.0.0" rasterio`
4. Install tool libraries - `pip3 install -r requirements.txt`

## [Lawley'22](https://www.sciencedirect.com/science/article/pii/S0169136821006612) Experiments

### Recreate MVT Expirments from [Lawley'22](https://www.sciencedirect.com/science/article/pii/S0169136821006612) using H3 Grid
1. Download the Lawley'22 datacube titled "2021_Table04_Datacube.csv" from the TA3 starter kit and place it within the `data/LAWLEY22-DATACUBE` directory of this repo.
2. All MVT experiments are within a corresponding notebook. Please open and view/run the cells of the notebook to view/run the experiment.
    
    * WOE baseline - `H3_MVT_WOE_baseline.ipynb`
    * WOE updated - `H3_MVT_WOE_updated.ipynb`
    * GBM preferred - `H3_MVT_GBM_preferred.ipynb`

### Recreate WOE baseline MVT Expirment from [Lawley'22](https://www.sciencedirect.com/science/article/pii/S0169136821006612) using S2 Grid
1. Generate the Lawley'22 datacube using the S2 Grid following the instructions in the [SRI TA3 preprocessing repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3-preprocess). Place the datacube CSV's generated for each continent into the `data/SRI-DATACUBE` directory of this repo.
2. The WOE baseline MVT experiment is within a corresponding notebook. Please open and view/run the cells of the notebook to view/run the experiment.

    * WOE baseline - `S2_MVT_WOE_baseline.ipynb`

## Output Rasters

### Rasterize the [Lawley'22](https://www.sciencedirect.com/science/article/pii/S0169136821006612) datacube that uses H3 Grid
1. Download the Lawley'22 datacube titled "2021_Table04_Datacube.csv" from the TA3 starter kit and place it within the `data/LAWLEY22-DATACUBE` directory of this repo.
2. View and run the `rasterize_H3_datacube` python notebook file.

### Rasterize the datacube generated by [SRI TA3 preprocessing repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3-preprocess) that uses S2 Grid
1. Generate the Lawley'22 datacube using the S2 Grid following the instructions in the [SRI TA3 preprocessing repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3-preprocess). Place the datacube CSV's generated for each continent into the `data/SRI-DATACUBE` directory of this repo.
2. View and run the `rasterize_S2_datacube` python notebook file.

### Prepare [Lawley'22](https://www.sciencedirect.com/science/article/pii/S0169136821006612) output rasters for [SRI TA3 modeling repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3)
1. Download the Lawley'22 datacube titled "2021_Table04_Datacube.csv" from the TA3 starter kit and place it within the `data/LAWLEY22-DATACUBE` directory of this repo.
2. View and run the `rasterize_H3_datacube` python notebook file.

The H3 rasterization notebook (i.e. `rasterize_H3_datacube.ipynb`) produces a set of single-band rasters that includes all input and target variables. The following notebook can be used to combine single-band rasters into a multi-band raster, which is expected in the [SRI TA3 modeling repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3). Using multi-band rasters streamlines the training loop, removing additional concatentation / read operations. Long-term, this script can be incorporated into the [SRI TA3 modeling repo](https://github.com/DARPA-CRITICALMAAS/sri-ta3) once the input data format is set.

3. View and run the `produce_multiband_raster` python notebook file.